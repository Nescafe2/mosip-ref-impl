<div class="time-selection">
    <app-heading-row [title]="'timeSelection.title_book' | translate" [extraTitle]="getSelectedCenterExtraTitle()"></app-heading-row>
    <div class="wrapper">
        <div *ngIf="!spinner" class="time-selection-content">
            <mat-card class="time-selection__date-card" *ngIf="availabilityData.length !== 0">
                <div>
                    <div class="container" dir="ltr">
                        <div class="left-button">
                            <a (click)="scrollLeft()"><img src="assets/img/arrow-right.png"/></a>
                        </div>
                        <div #widgetsContent class="middle">
                            <mat-card
                                    *ngFor="let data of availabilityData | slice: 0:days; let i = index"
                                    [ngClass]="data.holiday ? 'sizing disabled' : selectedTile === i ? 'sizing selected' : 'sizing'"
                                    (click)="dateSelected(i)">
                                <mat-card-content class="time-selection__date">
                                    <p class="time-selection__tile-date">{{ data.displayDate }}</p>
                                    <p class="time-selection__tile-date-text">{{ data.displayDay }}</p>
                                    <p class="time-selection__tile-availability-text-number">{{ data.TotalAvailable  }}</p>
                                    <div class="time-selection__tile-availability-text">{{ 'timeSelection.text_availability' | translate }}</div>
                                </mat-card-content>
                            </mat-card>
                        </div>
                        <div class="right-button">
                            <a (click)="scrollRight()"><img src="assets/img/arrow-right.png"/></a>
                        </div>
                        <div class="time-selection__arrow-text">
                        </div>
                    </div>
                </div>
            </mat-card>
            <div class="time-seelection__slot-groups-div" *ngIf="availabilityData.length !== 0">
                <a *ngIf="morningSlotAvailable"
                   (click)="tabSelected('morning')"
                   [ngClass]="activeTab === 'morning' ? 'time-seelection__slot-groups-div-selected' : 'time-seelection__slot-groups-div a'">
                    {{ 'timeSelection.text_morning' | translate }}
                </a>
                <a *ngIf="afternoonSlotAvailable"
                   (click)="tabSelected('afternoon')"
                   [ngClass]="activeTab === 'afternoon' ? 'time-seelection__slot-groups-div-selected' : 'time-seelection__slot-groups-div a'">
                    {{ 'timeSelection.text_afternoon' | translate }}
                </a>
            </div>
            <div class="time-selection__slots-div">
                <mat-card class="time-selection__time-slots-container">
                    <div *ngIf="availabilityData[selectedTile] !== undefined" #cardsContent class="middle-card">
                        <div *ngFor="let data of availabilityData[selectedTile].timeSlots; let i = index">
                            <mat-card
                                    *ngIf="data.tag === activeTab"
                                    [ngClass]="selectedCard === i ? 'card card-content selected-card' : 'card card-content'"
                                    (click)="cardSelected(i)">
                                <mat-card-content style="width:100%">
                                    <p class="card-time-text">
                                        {{ data.displayTime }}
                                    </p>
                                    <p [ngClass]="selectedCard === i ? 'card-slot-text selected' : 'card-slot-text'">
                                        {{ data.availability - data.names.length }} {{ 'timeSelection.text_slots' | translate }}
                                    </p>
                                    <div class="takenRDV">
                                        <span *ngIf="data.names.length !== 0"
                                              class="card-slot-text-span-number">{{ data.names.length }}</span>
                                        <span *ngIf="data.names.length != 0"
                                              class="card-slot-text-span-image"
                                              [ngClass]="data.names.length !== 0 ? 'wNum' : '' ">
                                            <span class="text-tak"> {{ 'timeSelection.text_taken' | translate }} </span>
                                        </span>
                                    </div>
                                </mat-card-content>
                            </mat-card>
                        </div>
                    </div>
                </mat-card>
                <mat-card class="time-selection__names-container"
                          *ngIf="availabilityData.length>0 && showsNamesContainer">
                    <div class="dataHour"
                         *ngIf="availabilityData[selectedTile] !== undefined && selectedCard !== undefined">
                        <div *ngIf="availabilityData[selectedTile] !== undefined && selectedCard !== undefined"
                             class="time-selection__name-list-header">
                            <span class="time-selection__names-header-date-text">{{ availabilityData[selectedTile].displayDay }}</span>
                            &nbsp;
                            <span class="time-selection__names-header-date-text">{{ availabilityData[selectedTile].displayDate }}</span>
                            <br/>
                            <span class="time-selection__names-header-time-text">
                                {{availabilityData[selectedTile].timeSlots[selectedCard].displayTime}}
                            </span>
                        </div>
                        <div *ngIf="availabilityData[selectedTile] !== undefined && selectedCard !== undefined">
                            <table class="time-selection__name-list">
                                <tr class="time-selection__name-list-item"
                                    *ngFor="let item of availabilityData[selectedTile].timeSlots[selectedCard].names; let j = index">
                                    <td>{{ item.firstName }} {{ item.lastName }}</td>
                                    <td>
                                        <mat-icon (click)="itemDelete(j)" class="name-delete-button">close</mat-icon>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div *ngIf="availabilityData[selectedTile] !== undefined && selectedCard !== undefined"
                             class="time-selection-indication-to-select-users-header">
                            <span class="time-selection-indication-to-select-users" *ngIf="usersNames.length > 1">
                                Veuilliez séléctionner la/les personne(s) pour la résérvation.
                            </span>
                        </div>
                    </div>
                    <div class="avableNames" *ngIf="deletedNames.length !== 0">
                        <div class="time-selection__name-list-header">
                            {{ 'timeSelection.text_available' | translate }}
                        </div>
                        <div>
                            <table class="time-selection__name-list">
                                <tr class="time-selection__name-list-item"
                                    *ngFor="let item of deletedNames; let k = index">
                                    <td>{{ item.firstName }} {{ item.lastName }}</td>
                                    <td>
                                        <mat-icon (click)="addItem(k)"
                                                  [ngClass]="disableAddButton ? 'name-delete-button disable_add' : 'name-delete-button'">
                                            add
                                        </mat-icon>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </mat-card>
            </div>
            <div>
                <mat-card class="time-selection__button-container">
                    <button (click)="navigateBack()"
                            class="user-back-btn">{{ 'timeSelection.action_back' | translate }}</button>
                    <div class="rightB">
                        <button (click)="navigateDashboard()" class="user-book_later-btn">
                            {{ 'timeSelection.action_bookLater' | translate }}
                        </button>
                        <button [disabled]="disableContinueButton" (click)="makeBooking()"
                                [ngClass]="disableContinueButton ? 'disabled-user-continue-btn' : 'user-continue-btn'">
                            {{ 'timeSelection.action_continue' | translate }}
                        </button>
                    </div>
                </mat-card>
            </div>
        </div>
    </div>
</div>
